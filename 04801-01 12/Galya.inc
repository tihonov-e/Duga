      ;******* - Проверка ВЫБРАННОГО КАНАЛА НА ГАЛЛЕТНИКЕ S13**************************
     ;******* Возврат: выходные битовые переменные:                    *********************
    ;******* CHN_1,CHN_2,CHN_3,CHN_4;CHN_0  --			БУФЕР OE_BTN1
  ;****** S2_x..S9_x:=1 - соответствующая клавиша НЕ нажата. ****************************
 ;****** Программное исключение одновременного нажатия нескольких клавиш. **************
;**************************************************************************************



TTI_G:
;** 21-01-2011 ***********************************************************************************

MOV P2, #0FFH

;************** БУФЕР OE_BTN1 ****************************************************************
    SETB	OE_BTN2
	CLR	OE_BTN1
			   
			    mov     B,#1   ; B:= Количество циклов,
                               ;     определяющих общее время проверки нажатия.
                ;-------------; ********************************************************
                             ; ********************************************************
                setb    CHN_1
                setb    CHN_2
                setb    CHN_3
                setb    CHN_4 ; Сброс в исходное состояние выходных битовых переменных.

;-------------------------------------------------------------
TTI_G_1:
                	
				jb      PORT_CHN_1,TTI_G_2
                		
				;----------------------------------
       ;- Дополнительная проверка нажатия кнопки в цепи PORT_CHN_1. ---
                mov     R7,#20
                lcall   delay_n_x_1_ms ; Задержка 20 мс.
                jnb     PORT_CHN_1,TTI_G1_SET
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret
TTI_G1_SET:
                clr     CHN_1
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret

;-------------------------------------------------------------
TTI_G_2:
                	
				jb      PORT_CHN_2,TTI_G_3
                	
				;----------------------------------
       ;- Дополнительная проверка нажатия кнопки в цепи PORT_CHN_2. ---
                mov     R7,#20
                lcall   delay_n_x_1_ms ; Задержка 20 мс.
                jnb     PORT_CHN_2,TTI_G2_SET
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret
TTI_G2_SET:
                clr     CHN_2
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret
;-------------------------------------------------------------

TTI_G_3:
                
				jb      PORT_CHN_3,TTI_G_4
                	
				;----------------------------------
       ;- Дополнительная проверка нажатия кнопки в цепи PORT_CHN_3. ---
                mov     R7,#20
                lcall   delay_n_x_1_ms ; Задержка 20 мс.
                jnb     PORT_CHN_3,TTI_G3_SET
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret
TTI_G3_SET:
                clr     CHN_3
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret
;-------------------------------------------------------------


TTI_G_4:
                
				jb      PORT_CHN_4,TTI_G_0
                	
				;----------------------------------
       ;- Дополнительная проверка нажатия кнопки в цепи PORT_CHN_4. ---
                mov     R7,#20
                lcall   delay_n_x_1_ms ; Задержка 20 мс.
                jnb     PORT_CHN_4,TTI_G4_SET
                ;--
                SETB	OE_BTN1
                SETB	OE_BTN2
				ret
TTI_G4_SET:
                clr     CHN_4
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret
;-------------------------------------------------------------
;ПРОВЕРКА, ЧТО ГАЛЯ СТОИТ В ПОЛОЖЕНИИ "0"
;ЕСЛИ  PORT_CHN_1...PORT_CHN_4 В "1", ТО ГАЛЯ В ПОЛОЖ. "0"

TTI_G_0:
                
				MOV		A,P2
				ANL		A,#0FH			   ; ЗАТИРАЕМ СТАРШИЕ 4 РАЗРЯДА ACC
				CJNE	A,#0FH,TTI_G_CUKL  ; СРАВНИВАЕМ 4 МЛ. РАЗРЯДА АСС С ЧИСЛОМ 00001111
											; ЕСЛИ РАВНО, ТО НА МЕТКУ  TTI_G0_SET, ЕСЛИ НЕТ, ТО НА TTI_G_CUKL

       ;- Дополнительная проверка нажатия кнопки в цепи PORT_CHN_0 ---
                mov     R7,#20
                lcall   delay_n_x_1_ms ; Задержка 20 мс.
				CJNE	A,#0FH,EXIT_G  ; СРАВНИВАЕМ 4 МЛ. РАЗРЯДА АСС С ЧИСЛОМ 00001111
TTI_G0_SET:
                clr     CHN_0
                ;--
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret

EXIT_G:
				;--
                SETB	OE_BTN1
                SETB	OE_BTN2
				ret
				;----------------------------------

;-------------------------------------------------------------



TTI_G_CUKL:
                djnz    B,TTI_G_1_000
                ;------------------------------------------------------------------------------
                SETB	OE_BTN1
				SETB	OE_BTN2
				ret
                ;****************************************************************
TTI_G_1_000:
                ljmp    TTI_G_1
                ;****************************************************************


